/* eslint-disable */
import resourcesFinal from './resources.json'; // Ruta dentro de la dist del bot
/* eslint-enable */

export const globalVars = {
  scriptName: 'name',
};
export const botVars = {
  hola: 'dsf',
  user_vars: {},
};
export const msgParams = {
  message: '',
  aiPayload: {
    conversationId: 'id',
    originator: 'flowjs://@xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx/',
  },
};
export const ScriptFunctions = { log: () => 'hola', IdleTime: () => {}, doGetRequest: () => '{}' };

export const multimediaConsts = [];
export const setMultimediaConst = (data) => {
  multimediaConsts.push(data);
};
export const Guid = { NewGuid: () => 'test-guid-1234' };
const resourcesConsts = resourcesFinal;
(()=>{"use strict";var e={d:(t,s)=>{for(var a in s)e.o(s,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:s[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{BuscarPersonaje:()=>Ma,Memory:()=>ua,MenuPrincipal:()=>Aa,Navigation:()=>ga,VerPersonajesRandom:()=>Sa,cierreConversacion:()=>Ta,commandReceived:()=>Ea,eventReceived:()=>Va,finish:()=>Ra,messageReceived:()=>Ca,start:()=>Oa});var s={d:(e,t)=>{for(var a in t)s.o(t,a)&&!s.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},a={};s.d(a,{AI:()=>m,kd:()=>p,Xb:()=>o,tn:()=>n,wB:()=>v,Yd:()=>r,zp:()=>u,st:()=>h,W_:()=>i,so:()=>d,mI:()=>c,cQ:()=>g,n8:()=>f,Wo:()=>l});var n={};s.r(n),s.d(n,{requestGet:()=>_,requestPost:()=>y,requestPut:()=>b});var o={};s.r(o),s.d(o,{get:()=>P,init:()=>$});var r={};s.r(r),s.d(r,{critical:()=>O,debug:()=>I,error:()=>x,info:()=>A,log:()=>M,logBot:()=>T,warning:()=>N});var i={};s.r(i),s.d(i,{execute:()=>B,getAttempts:()=>H,getNextBotCalled:()=>W,getProcessedAttempts:()=>te,getTerminated:()=>J,getValidResult:()=>Z,idle:()=>D,processAttempt:()=>ee,resetAttempts:()=>X,setBotJS:()=>j,setIdleFunction:()=>z,setNextBot:()=>G,setNextFunction:()=>L,setTerminated:()=>k,setValidResult:()=>U,setWaitFunction:()=>q,validateAttempts:()=>Y});var c={};s.r(c),s.d(c,{capitalizeFirstWord:()=>oe,capitalizeText:()=>re,cleanCapitalize:()=>ie,formattedJsonAsMessage:()=>ce,getNumber:()=>ne,levenstein:()=>ae,trimHelper:()=>se});var d={};s.r(d),s.d(d,{setDefaultValues:()=>le,setStepConversation:()=>de});var l={};s.r(l),s.d(l,{aiMessageType:()=>ue,cancelMessage:()=>Xe,createAction:()=>Re,createBodyMessageCard:()=>Te,createBodyMessageCarousel:()=>Ce,createBodyMessageCart:()=>Ve,createBodyMessageFile:()=>xe,createBodyMessageTemplate:()=>Oe,createBodyMessageText:()=>Ne,createInvite:()=>Me,createMessageAI:()=>Ae,createPaymentLink:()=>Ee,createUri:()=>Ie,createYggsMenu:()=>Be,evaluateMenuOption:()=>Le,getCoordinates:()=>Ke,getImageLink:()=>ve,getImageTitle:()=>he,getMessageClean:()=>Se,getMessageFormat:()=>Ye,getMessageText:()=>pe,messageAI:()=>Qe,sendAIMessage:()=>je,sendAction:()=>_e,sendAddToConversation:()=>Pe,sendCard:()=>we,sendCarousel:()=>Fe,sendConsecutiveMessages:()=>me,sendDocument:()=>He,sendMenu:()=>Je,sendMessage:()=>be,sendMessageAudio:()=>Ge,sendMessageDocument:()=>We,sendMessageForm:()=>Ze,sendMessageImage:()=>qe,sendMessageText:()=>$e,sendMessageVideo:()=>ze,setConsecutiveBehavior:()=>ge,showMenu:()=>De,validateMenu:()=>fe});var u={};s.r(u),s.d(u,{addJsonElement:()=>Kt,buildStepConversation:()=>ut,chatVarExists:()=>Et,clearDocumentVars:()=>Pt,clearMemory:()=>Wt,clearScoreVars:()=>At,clearUserVars:()=>bt,getAiPayload:()=>jt,getBotUUID:()=>es,getBotVars:()=>ft,getChatVar:()=>Rt,getClientId:()=>Ft,getCommandResponse:()=>ht,getConsecutiveBehavior:()=>ct,getConversationId:()=>wt,getDocumentVar:()=>$t,getGbmRobot:()=>ss,getInstantBehavior:()=>lt,getLocalRoute:()=>Ut,getLocalSubroute:()=>Lt,getMessageId:()=>qt,getParticipantName:()=>Xt,getParticipants:()=>Zt,getParticipantsAgents:()=>Ht,getParticipantsBots:()=>Qt,getParticipantsUsers:()=>Yt,getProtocol:()=>Jt,getRemote:()=>kt,getResult:()=>zt,getScoreVar:()=>It,getSetting:()=>Ot,getSettingBot:()=>Ct,getStepConversations:()=>Gt,getUserId:()=>Bt,getUserVar:()=>yt,pushActionsMessages:()=>vt,pushCancelMessages:()=>pt,pushOutMessages:()=>gt,pushStepConversation:()=>mt,setChatVar:()=>Vt,setCommandResponse:()=>Nt,setConsecutiveBehavior:()=>it,setDocumentVar:()=>St,setGbmRobot:()=>ts,setInstantBehavior:()=>dt,setScoreVar:()=>Mt,setSetting:()=>xt,setSettingBot:()=>Tt,setUserVar:()=>_t});var g={};s.r(g),s.d(g,{cleanPhone:()=>ys,createRegExp:()=>fs,evaluatePattern:()=>_s,fileToBase64:()=>is,geoDistance:()=>ds,getFormattedDate:()=>hs,getMultimedia:()=>ps,getRandomNumbers:()=>os,getResource:()=>ms,getSecrets:()=>gs,getText:()=>us,guid:()=>rs,lang:()=>as,replaceGlobalVariables:()=>ls,secondsToTimestamp:()=>cs,welcomeMessage:()=>ns});var m={};s.r(m),s.d(m,{agent:()=>bs,finishAI:()=>Is,getFullInteractionAI:()=>Ps,getInteractionAI:()=>$s,jsonFileName:()=>Ss,startAI:()=>Ms});var p={};s.r(p),s.d(p,{agentsGet:()=>Ls,channelsGet:()=>Us,chatAssignAgentById:()=>Os,chatAssignAgentByUsername:()=>Ts,chatAssignChannelById:()=>Cs,chatAssignVirtualChannelById:()=>Vs,chatsAssign:()=>xs,chatsClose:()=>Bs,chatsGet:()=>Rs,chatsGetContact:()=>Es,chatsResult:()=>Ds,chatsSetMetadata:()=>Js,chatsSetTags:()=>ks,chatsStart:()=>ws,chatsUpdateContact:()=>js,chatsWrite:()=>Fs,getChannel:()=>Gs,getDomain:()=>Ns,getTenant:()=>As,jbotsBlob:()=>qs,sendScore:()=>zs});var v={};s.r(v),s.d(v,{SERVICES_NAME:()=>Ws,getOCRText:()=>Zs});var h={};s.r(h),s.d(h,{evaluate:()=>Xs,sendFeedback:()=>Ys});var f={};s.r(f),s.d(f,{getScheduleType:()=>ca,isDate:()=>ta,isEmail:()=>Qs,isMoney:()=>Ks,isNegativeNumber:()=>oa,isNumeric:()=>ea,isPhone:()=>Hs,isValidCP:()=>na,isValidCurrentDay:()=>aa,isValidName:()=>sa,isValidWord:()=>ra});const _=(e,t="",s="{}",a=30)=>JSON.parse(ScriptFunctions.doGetRequest(e,t,s,a)),y=(e,t,s,a="{}",n=30)=>JSON.parse(ScriptFunctions.doPostRequest(e,t,s,a,n)),b=(e,t,s,a="{}",n=30)=>JSON.parse(ScriptFunctions.doPutRequest(e,t,s,a,n)),S=e=>`__env__${e}`,$=e=>{const t=e.staging;Object.keys(t).forEach((e=>{_t(S(e),t[e])}))},P=e=>yt(S(e)),M=(e,t="info")=>{const s=globalVars?.conversationId;let a=e;void 0!==s&&(a=`ConvId[${s}] ${e}`),ScriptFunctions.log(a,t)},I=e=>M(e,"debug"),A=e=>M(e,"info"),N=e=>M(e,"warning"),x=e=>M(e,"error"),O=e=>M(e,"critical"),T=(e,t=1)=>{P("DEBUG")&&$e(`${us("MensajesGenerales.log")} ${e}`,t)};let C,V=!1,R=!1,E=!1;const j=e=>{C=e},w=()=>"undefined"!=typeof BotJS?BotJS:C,F=e=>{const{uri:t}=e;if(t.startsWith("yccht")){const e=Ie(t);_t("_tenant_name_",e.route),msgParams.tenant_name=e.route}},B=()=>{let e;if(void 0===botVars.user_vars&&(botVars.user_vars={}),void 0===botVars.doc_vars&&(botVars.doc_vars={}),msgParams.tenant_name=yt("_tenant_name_"),msgParams.chat_id=globalVars.conversationId,void 0===yt("_tenant_name_")){M("Tenant name es null");const e=Ie(msgParams.aiPayload.remote),{subroute:t}=e;if(_t("_tenant_name_",t),msgParams.tenant_name=t,M(`Tenant name es: ${t}`),void 0===msgParams.tenant_name&&"event"===msgParams.type&&"conversation"===msgParams.aiPayload.category&&"cdp"===msgParams.aiPayload.type){const{participants:e}=msgParams.aiPayload.body.cdp;e.forEach(F)}}if("message"===msgParams.type){const t={res:e};(e=>{if(e.res=w().messageReceived(),!1!==e.res&&!1===V)if(void 0!==botVars.function){let e=w();botVars.function.split(".").forEach((t=>{e=e[t]})),e()}else w().start()})(t),e=t.res}else"command"===msgParams.type&&"function"==typeof w().commandReceived?e=w().commandReceived():"event"===msgParams.type&&"function"==typeof w().eventReceived&&(e=w().eventReceived());V&&w().finish()},D=()=>{if(void 0!==botVars.idleFunction){let e=w();botVars.idleFunction.split(".").forEach((t=>{e=e[t]})),e()}},J=()=>V,k=(e,t)=>{V=!0;const s="finish"===e?"terminateConversation":"bye",a={};void 0!==t&&(a.delay=t),_e(s,a)},U=e=>{E=e},L=e=>{botVars.function!==e&&U(!0),botVars.function=e},q=L,z=(e,t)=>{botVars.idleFunction=e,ScriptFunctions.IdleTime(msgParams.unique_id,t,JSON.stringify(msgParams.aiPayload))},G=e=>{botVars.bot_name=e,botVars.function=void 0,R=!0},W=()=>R,Z=()=>E,X=(e="attempts")=>{_t(e+"_attempts_",0),_t("_attempts_",0)},Y=(e="attempts",t=(()=>{}),s=(()=>{}),a=3)=>{let n=yt(e+"_attempts_");n?n+=1:n=1,_t(e+"_attempts_",n),n<a?"function"==typeof t&&t():"function"==typeof s&&s()},H=(e="attempts")=>yt(e+"_attempts_")||0,Q=e=>"function"==typeof e,K=(e,t,s)=>{Q(e)&&t&&e(t,s)},ee=(e,t,s,a,n="",o=us("DEFAULT.RETRY"),r=3)=>{if(_t("_attempts_",(yt("_attempts_")||0)+1),yt("_attempts_")>=r)return K(t,e,us("DEFAULT.REPORT_CBOTS_DB_MAX_ATTEMPTS")),void(Q(a)&&a());n?q(n):Q(s)&&s(),$e(o,1,{StepId:1e3}),K(t,e,us("DEFAULT.REPORT_CBOTS_DB_INVALID_ATTEMPT"))},te=()=>yt("_attempts_")||0,se=(e,t)=>{let s=0,a=e.length;for(;s<a&&e[s]===t;)s+=1;for(;a>s&&e[a-1]===t;)a-=1;return s>0||a<e.length?e.substring(s,a):e},ae=(e,t)=>{if(0===e.length)return t.length;if(0===t.length)return e.length;const s=[];let a,n;for(a=0;a<=t.length;a+=1)s[a]=[a];for(n=0;n<=e.length;n+=1)s[0][n]=n;for(a=1;a<=t.length;a+=1)for(n=1;n<=e.length;n+=1)t.charAt(a-1)===e.charAt(n-1)?s[a][n]=s[a-1][n-1]:s[a][n]=Math.min(s[a-1][n-1]+1,Math.min(s[a][n-1]+1,s[a-1][n]+1));return s[t.length][e.length]},ne=e=>e.match(/\d+/),oe=e=>e.trim().replace(/^\w/,(e=>e.toUpperCase())),re=e=>e.trim().toLowerCase().replace(/\w\S*/g,(e=>e.replace(/^\w/,(e=>e.toUpperCase())))),ie=e=>re(Se(e)),ce=e=>{let t="";return Object.entries(e).forEach((([e,s])=>{t=`${t} ${e}: ${s}\n`})),t},de=({StepId:e,Content:t,Anchor:s,Name:a})=>({ConversationId:wt().toString(),BotId:es().toString(),ClientId:Ft(),UserId:Bt(),BusinessId:Ut().toString(),DestinationId:kt(),Steps:[{StepId:e,Name:a,Content:t,Anchor:s,AnchorStep:{SelectedOption:yt("anchorSelectedOption")}}]}),le=(e={})=>{if(void 0!==(e={Name:"",Anchor:!1,...e}).StepId)return e},ue={TEXT:"text",FILE:"file",CARD:"card",CAROUSEL:"carousel",TEMPLATE:"template",PAYMENTRESULT:"paymentResult",CUSTOM:"custom",CART:"cart"},ge=e=>{it(e)},me=()=>{const e=yt("__consecutiveMessages__");Array.isArray(e)&&e.length>0&&(ge(!0),e.forEach(gt))},pe=()=>msgParams.message,ve=()=>jt()?.body?.url,he=()=>jt()?.body?.title,fe=(e,t,s,a)=>{void 0===s&&(s=pe().toLowerCase());const n=s.match(/\d+(?:[.,]\d+)?/g);if(1===s.length&&a){const a=s.charCodeAt(0)-96;if(a>=e&&a<=t)return a}else if(null!=n){const s=parseInt(n[0],10);if(s===Number(n[0])&&s>=e&&s<=t)return s}return-1},_e=(e,t)=>{const s={};s.type=e,void 0!==t&&(s.params=t),vt(s)},ye=()=>{const e=ss();return e?{name:e,type:"robot"}:null},be=(e,t,s,a,n,o,r,i)=>{const c=rs(),d={},l={version:"1.0.0",conversationId:"",originator:"",messageId:"",timestamp:"",language:"es",metadata:"",body:{}};r&&(l.whisper=r);const u=ye();if(u&&(l.originatorDescription=u),void 0!==e)if(null!==e){if(""!==e){switch(t){case"text":l.type=t,l.body.text=e;break;case"custom":l.type=t,l.body.text=e,l.customBody={},l.customBody.customType=n,l.customBody.formData=a;break;default:l.type="file",l.body.url=e,l.body.text=a,l.body.mime=o}return d.aiMessage=l,d.delay=s,gt(d,i),mt(e,i),c}M("Mensaje vacío","error")}else M("Mensaje null","error");else M("Mensaje undefined","error")},Se=e=>{if(void 0!==e||void 0!==(e=pe()))try{const t="àáäâèéëêìíïîòóöôùúüûñçßÿœæŕśńṕẃǵǹḿǘẍźḧ·/_,:;",s="aaaaeeeeiiiioooouuuuncsyoarsnpwgnmuxzh------",a=new RegExp(t.split("").join("|"),"g");return e=e.toString().toLowerCase().replace(/\s+/g,"-").replace(a,(e=>s.charAt(t.indexOf(e)))).replace(/[^\w-]+/g,"").replace(/--+/g,"-").replace(/-/g," "),e=se(e," ")}catch(e){}},$e=(e,t,s)=>(s=le(s),be(e,"text",t,void 0,void 0,void 0,void 0,s)),Pe=(e,t)=>{const s={};if(!1===Array.isArray(e)){const t=[];void 0!==e&&t.push(e),s.invites=t}else s.invites=e;if(!1===Array.isArray(t)){const e=[];void 0!==t&&e.push(t),s.messages=e}else s.messages=t;_e("addToConversation",s)},Me=(e,t,s,a)=>{const n={};if(void 0===e)return null;if(n.remote=e,void 0!==t)n.conversationId=t;else{if(t=globalVars?.conversationId,void 0===t)return null;n.conversationId=t}return void 0!==s?n.clientId=s:(s=msgParams.aiPayload?.clientId,n.clientId=void 0===s?0:s),void 0!==a?n.userId=a:(a=msgParams.aiPayload?.userId,n.userId=void 0===a?0:a),n},Ie=e=>e.match("^(?<protocol>.*?)://(?<destinatary>.*?)(:(?<subdestinatary>.*?)){0,1}(@(?<route>.*?)){0,1}(;(?<provider>.*?)){0,1}(:(?<subroute>.*?)){0,1}(/(?<extra>.*?)/{0,1}){0,1}(#(?<unique>.*)){0,1}$").groups,Ae=(e,t,s)=>{const a={ai:"1.0.0"};return a.messageId=rs(),a.conversationId=globalVars?.conversationId,a.timestamp=(new Date).toISOString(),a.originator=globalVars?.originator,a.type=e,a.body=t,a.actions=s,a},Ne=e=>void 0===e?null:{text:e},xe=(e,t,s,a,n)=>void 0===e||void 0===t?null:{url:e,mime:t,text:s,thumbnailUrl:a,fileName:n,forceRefresh:!1},Oe=(e,t,s,a)=>void 0===e?null:{template:e,url:t,mime:s,params:a},Te=(e,t,s,a,n,o="vertical",r="large",i=null)=>({title:e,description:t,url:s,orientation:o,size:r,alignment:i,mime:a,actions:n}),Ce=(e,t)=>void 0===e?null:{items:e,width:t},Ve=(e,t,s,a,n)=>void 0===e||null==e||void 0===n?null:{catalogId:e,title:t,description:s,footer:a,productItems:n},Re=(e,t,s,a=null)=>void 0===e||void 0===t?null:{type:e,text:t,postback:s,actionData:a},Ee=(e,t,s,a,n)=>{const o={},r=[];let i;o.conversationId=e.conversationId,o.clientId=e.clientId,o.userId=e.userId,o.merchantId=a,void 0!==e.body?.text?o.description=e.body.text:o.description="Pago de productos",e.body?.productItems.forEach((e=>{const t={};t.quantity=e.quantity,t.unitPrice=100*e.itemPrice,void 0!==e?.productId&&(t.name=e.productId),i="MXN",r.push(t)}));const c=Ie(e.originator).destinatary;return void 0!==n&&""!==n&&null!=n||(n="Auronix"),o.customer={name:n,email:t,phone:c},o.itemsOrder=r,o.currency=i,o.paymentMethods=["card","transfer"],o.monthlyOptions=[3,6,9,12],o.eventsTextMode=!1,y(s,JSON.stringify(o),!0)},je=(e,t=0,s)=>{const a=void 0!==e.body?.text?e.body?.text:e.body,n=ye();n&&(e.originatorDescription=n),gt({aiMessage:e,delay:t}),s=le(s),mt(a,s)},we=(e,t,s,a,n,o="vertical",r="large",i=null,c=0,d)=>{const l=Te(e,t,s,a,n,o,r,i),u=Ae(ue.CARD,l);je(u,c,d)},Fe=(e,t,s=0,a)=>{const n=((e,t)=>{for(let s=0;s<e.length;s+=1)e[s].orientation="vertical",e[s].size=t;return e})(e,t),o=Ce(n,t),r=Ae(ue.CAROUSEL,o);return je(r,s,a),e},Be=(e,t,s,a,n)=>{const o=s.length,r=[];let i;for(let e=0;e<o;e+=1){const t=Re("reply",s[e],`${e+1}`);r.push(t)}if(void 0!==a){const e=Te(void 0,t,a,"image/jpeg",r);i=Ae(ue.CARD,e)}else{const e=Ne(t);i=Ae(ue.TEXT,e,r)}return _t(`_menu_options_${e}`,s),_t(`_menu_text_${e}`,t),_t(`_menu_retries_${e}`,100),_t(`_menu_count_${e}`,0),_t(`_menu_letters_${e}`,!1),i},De=(e,t,s,a,n,o,r=0,i)=>{void 0!==i&&(i.Name=e);const c=Be(e,t,s,a,"auto");return je(c,r,i)},Je=(e,t,s,a,n=0,o=null,r)=>{void 0!==r&&(r.Name=e);const i=Be(e,t,s,a,"auto");return o&&(i.body.footer=o),je(i,n,r)},ke=(e,t)=>{let s=ae(e,t);return(t.includes(e)||e.includes(t))&&(s=s/(Math.min(t.length,e.length)+1)*2),s},Ue=(e,t,s,a,n)=>a<Math.max(t.length,e.length)/2?n+1:s,Le=(e,t,s=!1,a=!1,n=!1)=>{let o=-1;try{if(t.startsWith("http://")||t.startsWith("https://"))return-1;!0===a&&$e(`Name: ${e}, Option: ${t}`);const r=yt(`_menu_options_${e}`);if(null!=r){const i=r.length;if(Object.keys(r).forEach((e=>{r[e]=`${Se(r[e])}`})),o=((e,t,s,a)=>{const n=t.length;let o="",r=fe(1,n,s,yt(`_menu_letters_${a}`));if(s=` ${Se(s)} `,!0===e&&$e(`ValidateMenu: ${r}`),-1===r){let a=-1;for(let i=0;i<n;i+=1){const n=` ${t[i]} `,c=ke(n,s);!0===e&&(o+=`${n}: ${c}\n`),(-1===a||-1!==a&&c<a)&&(a=c,r=Ue(n,s,r,c,i))}!0===e&&$e(o)}return r})(a,r,t,e),n&&_t("anchorSelectedOption",o),-1===o){const t=yt(`_menu_retries_${e}`),a=yt(`_menu_count_${e}`);if(-1==t||a<t){if(_t(`_menu_count_${e}`,a+1),!0===s){const t=yt(`_menu_text_${e}`);$e(`Opción incorrecta. Se esperaba un número del 1 al ${i}. ${t}`)}}else k("start")}}}catch(e){return!0===a&&$e(`Error: ${e}`),-1}return o},qe=(e,t,s,a)=>{a=le(a),be(e,"image",t,s,void 0,void 0,void 0,a)},ze=(e,t,s,a,n)=>{n=le(n),be(e,"video",t,s,"video",a,void 0,n)},Ge=(e,t,s,a)=>{a=le(a),be(e,"audio",t,"","audio",s,void 0,a)},We=(e,t,s,a)=>{a=le(a),be(e,"document",t,"","document",s,void 0,a)},Ze=(e,t,s,a,n)=>{n=le(n),be(e,"custom",t,s,a,void 0,void 0,n)},Xe=e=>pt(e),Ye=()=>msgParams.format,He=(e,t)=>{const s={};s.chat_id=msgParams.chat_id,s.name=botVars.bot_name,s.title=void 0===t?msgParams.sender:t,s.type=void 0===e?botVars.bot_name:e,s.values=botVars.doc_vars;const a=`${CalixtaChat.getDomain()}/webhooks/jbots/document`;y(a,JSON.stringify(s),!0)},Qe=(e,t,s)=>(void 0===msgParams.unique_id&&(msgParams.unique_id=""),s?JSON.parse(ScriptFunctions.dialogFlowDetectIntent(e,t,msgParams.unique_id,s)):JSON.parse(ScriptFunctions.aiTextRequest(e,msgParams.unique_id,t))),Ke=()=>{let e=null,t=null;const s=pe(),a=Ye();if("gps"===a&&s)[e,t]=s.split(",");else if("text"===a){let a=s.split("/").pop();a.includes(",")&&s.includes("google.com")&&s.includes("/maps/")&&(a=a.replace("@",""),[e,t]=a.split(","))}return{latitude:e,longitude:t}},et=[],tt=[],st=[],at=[];let nt=!1,ot={},rt=!1;const it=e=>{nt=e},ct=()=>nt,dt=e=>{rt=e},lt=()=>rt,ut=(e,t)=>de({StepId:t.StepId,Content:e,Anchor:t.Anchor,Name:t.Name}),gt=(e,t=null)=>{if(lt()){let{delay:s}=e;s||(s=0),e.delay=s+1;const a=t?ut(e.aiMessage.body.text,t):null;ScriptFunctions.SendInstantMessage(msgParams.aiPayload.messageId,JSON.stringify(e),a?JSON.stringify(a):null)}else et.push(e)},mt=(e,t)=>{if(void 0===t)return;const s=ut(e,t);tt.push(s)},pt=e=>{st.push(e)},vt=e=>{if(lt()){const{params:t}=e;if(t){let{delay:s}=t;s||(s=1),e.params.delay=-s}ScriptFunctions.SendInstantAction(msgParams.aiPayload.messageId,JSON.stringify(e))}else at.push(e)},ht=()=>ot,ft=()=>JSON.stringify(botVars),_t=(e,t)=>{botVars.user_vars[e]=t},yt=e=>botVars.user_vars[e],bt=()=>{botVars.user_vars={}},St=(e,t,s="text",a)=>{botVars.doc_vars[e]={format:s,value:t,...a&&{param:a}}},$t=e=>botVars.doc_vars[e],Pt=()=>{botVars.doc_vars={}},Mt=(e,t,s="text")=>{botVars.score_vars[e]={format:s,value:t}},It=e=>botVars.score_vars[e],At=()=>{botVars.score_vars={}},Nt=(e,t,s)=>{ot={...ot,type:e,uri:t,events:s}},xt=(e,t)=>ScriptFunctions.setSetting(globalVars.scriptName,e,t),Ot=e=>ScriptFunctions.getSetting(globalVars.scriptName,e),Tt=(e,t)=>ScriptFunctions.setSetting(`${globalVars.scriptName}:${msgParams.sender}`,e,t),Ct=e=>ScriptFunctions.getSetting(`${globalVars.scriptName}:${msgParams.sender}`,e),Vt=(e,t)=>{const s=`${msgParams.chat_id}_${msgParams.unique_id}`;ScriptFunctions.setVar(s,e,t)},Rt=e=>{const t=`${msgParams.chat_id}_${msgParams.unique_id}`;return ScriptFunctions.getVar(t,e)},Et=e=>{const t=`${msgParams.chat_id}_${msgParams.unique_id}`;return ScriptFunctions.varExists(t,e)},jt=()=>msgParams.aiPayload??{},wt=()=>jt().conversationId,Ft=()=>(M(`AIPayload: ${JSON.stringify(jt())}`),jt().clientId),Bt=()=>jt().userId,Dt=()=>jt().originator,Jt=()=>Ie(Dt()).protocol,kt=()=>Ie(Dt()).destinatary,Ut=()=>Ie(Dt()).route,Lt=()=>Ie(Dt()).subroute,qt=()=>msgParams.aiPayload.messageId,zt=()=>{const e={messages:ct()?et.slice(0,1):et,cancel:st,actions:at,response:ot};return ct()&&_t("__consecutiveMessages__",et.slice(1)),JSON.stringify(e)},Gt=()=>JSON.stringify(tt),Wt=()=>{tt.splice(0,et.length),et.splice(0,et.length),st.splice(0,st.length),at.splice(0,at.length),nt=!1,ot={},rt=!1},Zt=()=>yt("__participants__"),Xt=()=>{const e=Zt();if(Array.isArray(e)&&e.length)return e.filter((e=>{const t=e.remoteInfo?.isSystem,{protocol:s}=Ie(e.uri);return!("true"===t||["db","balancer","flowjs","yccht"].includes(s))}))[0].remoteInfo?.displayName},Yt=()=>{const e=Zt();if(Array.isArray(e)&&e.length){const t=["db","balancer","flowjs","yccht"];return e.filter((e=>{const{protocol:s}=Ie(e.uri);return!t.includes(s)})).map((e=>e.uri))}},Ht=()=>{const e=Zt();if(Array.isArray(e)&&e.length)return e.filter((e=>{const{protocol:t}=Ie(e.uri);return"yccht"===t})).map((e=>e.uri))},Qt=()=>{const e=Zt();if(Array.isArray(e)&&e.length)return e.filter((e=>{const{protocol:t}=Ie(e.uri);return"flowjs"===t})).map((e=>e.uri))},Kt=(e,t,s)=>{let a=yt(s);a||(a={},_t(s,a)),a[e]=t,_t(s,a)},es=()=>globalVars.scriptName,ts=e=>{_t("__gbm__robotName__",e)},ss=()=>yt("__gbm__robotName__"),as="es",ns=()=>{const e=(new Date).toLocaleString("es-MX",{timeZone:"America/Mexico_City"}),t=new Date(e).getHours();return t>=0&&t<12?"Buenos días":t>=12&&t<19?"Buenas tardes":"Buenas noches"},os=()=>[Random.NextDouble()],rs=()=>Guid.NewGuid(),is=e=>ScriptFunctions.fileToBase64(e),cs=(e=0)=>{const t=new Date;return t.setSeconds(t.getSeconds()+e),0===e?e:Math.floor(t/1e3)},ds=(e,t,s,a)=>{if(e===s&&t===a)return 0;const n=Math.PI*e/180,o=Math.PI*s/180,r=t-a,i=Math.PI*r/180;let c=Math.sin(n)*Math.sin(o)+Math.cos(n)*Math.cos(o)*Math.cos(i);return c>1&&(c=1),c=Math.acos(c),c=180*c/Math.PI,c=60*c*1.853159616,c},ls=e=>{const t=/(\{\$)([A-Z\d_])+(\$\})/g;if(null!=e){const s=e.match(t);if(null!=s)return s.filter(((e,t,s)=>s.indexOf(e)===t)).forEach((t=>{const s=t.replace("{$","").replace("$}","");e=e.replaceAll(t,yt(s))})),ls(e)}return e},us=e=>{let t=resourcesConsts;const s=e.split(".");return s.unshift(as),s.some((e=>(t=t[e]?t[e]:void 0,"object"!=typeof t))),"string"==typeof t?ls(t):e},gs=e=>void 0!==secretsConsts[e]?secretsConsts[e]:e,ms=e=>{let t=resourcesConsts;const s=e.split(".");if(s.unshift(as),s.some((e=>(t=e in t?t[e]:void 0,"object"!=typeof t))),void 0!==t){const e=JSON.stringify(t),s=ls(e);return JSON.parse(s)}return e},ps=(e,t=null)=>{const s=multimediaConsts.filter((t=>t.name===e))[0];return s?t?s[t]:s:null},vs=e=>e.toString().padStart(2,"0"),hs=(e="dd/mm/aaaa",t=new Date)=>{if(t instanceof Date!=1)return"Not valid date instance";if("string"!=typeof e)return"Not valid format";const s=t.getFullYear(),a=s.toString().substring(2),n=vs(t.getMonth()+1),o=vs(t.getDate()),r=vs(t.getHours()),i=vs(t.getMinutes()),c=vs(t.getSeconds());let d="";switch(e){case"dd-mm-aaaa":d=`${o}-${n}-${s}`;break;case"aaaa/mm/dd":d=`${s}/${n}/${o}`;break;case"mm/dd/aa":d=`${n}/${o}/${a}`;break;case"dd/mm/aa hh:mm:ss":d=`${o}/${n}/${a} ${r}:${i}:${c}`;break;case"dd/mm/aaaa hh:mm:ss":d=`${o}/${n}/${s} ${r}:${i}:${c}`;break;default:d=`${o}/${n}/${s}`}return d},fs=e=>{const t=e.length,s=e.substring(0,1),a=e.substring(t-1,t),n=e.replace("*","");return s.includes("*")&&a.includes("*")?new RegExp(`${n}`,"i"):s.includes("*")?new RegExp(`${n}$`,"i"):a.includes("*")?new RegExp(`^${n}`,"i"):new RegExp(`^${n}$`,"i")},_s=(e,t)=>{let s=!1;const a=Se(e.toLowerCase());return t.forEach((e=>{const t=e.toLowerCase();fs(t).test(a)&&(s=!0)})),s},ys=e=>{try{const t=/\d+/g,s=e.match(t).join("");return s.length>=10&&s.length<=14?s:void 0}catch(e){return}},bs="interactions-a9e51",Ss=`${bs}-d19584f55070.json`,$s=e=>{try{const t=JSON.parse(ScriptFunctions.dialogFlowDetectIntent(Ss,bs,`${msgParams.unique_id}_${Math.floor(1e4*os()[0]+1)}`,e));return"Default Fallback Intent"===t.intent?"none":t.intent}catch(e){return"none"}},Ps=e=>JSON.parse(ScriptFunctions.dialogFlowDetectIntent(Ss,bs,`${msgParams.unique_id}_${Math.floor(1e4*os()[0]+1)}`,e)),Ms=e=>ScriptFunctions.aiStartAgent(msgParams.unique_id,e),Is=()=>ScriptFunctions.aiFinishAgent(msgParams.unique_id),As=()=>msgParams.tenant_name,Ns=(e=null)=>{const t=As();let s=e||"calixtachat";return"sandbox"!==t||e||(s="dev.aurochat"),`https://${t}.${s}.com`},xs=(e,t={},s=null)=>{const a=msgParams.chat_id,n=`${Ns(s)}/api/v1/chats/${a}/assign`,o={...t,api_token:e};return b(n,JSON.stringify(o),!1)},Os=(e,t,s=null)=>xs(e,{user_id:t},s),Ts=(e,t,s=null)=>xs(e,{username:t},s),Cs=(e,t,s=null)=>xs(e,{channel_id:t},s),Vs=Cs,Rs=e=>{const t=`${Ns()}/api/v1/chats/${msgParams.chat_id}`,s={api_token:e};return _(t,JSON.stringify(s))},Es=e=>{const t=`${Ns()}/api/v1/chats/${msgParams.chat_id}/contact`,s={api_token:e};return _(t,JSON.stringify(s))},js=(e,t={})=>{const s=`${Ns()}/api/v1/chats/${msgParams.chat_id}/contact`,a={...t,api_token:e};return b(s,JSON.stringify(a),!1)},ws=(e,t={})=>{const s=`${Ns()}/api/v1/chats`,a={...t,api_token:e};return y(s,JSON.stringify(a),!1)},Fs=(e,t={})=>{const s=`${Ns()}/api/v1/chats/${msgParams.chat_id}/write`,a={...t,api_token:e};return y(s,JSON.stringify(a),!1)},Bs=(e,t={},s=msgParams.chat_id)=>{const a=`${Ns()}/api/v1/chats/${s}/close`,n={...t,api_token:e};return b(a,JSON.stringify(n),!1)},Ds=(e,t={},s=msgParams.chat_id)=>{const a=`${Ns()}/api/v1/chats/${s}/result`,n={...t,api_token:e};return b(a,JSON.stringify(n),!1)},Js=(e,t,s)=>{const a=`${Ns()}/api/v1/chats/${msgParams.chat_id}/metadata`,n={api_token:e};return n[t]=s,b(a,JSON.stringify(n),!1)},ks=(e,t)=>{const s=`${Ns()}/api/v1/chats/${msgParams.chat_id}/tags`,a={tags:t,api_token:e};return b(s,JSON.stringify(a),!1)},Us=e=>{const t=`${Ns()}/api/v1/channels`,s={api_token:e};return _(t,JSON.stringify(s))},Ls=(e,t)=>{const s=`${Ns()}/api/v1/agents`;let a={};return void 0!==t&&(a=t),a.api_token=e,_(s,JSON.stringify(a))},qs=e=>y("https://demos.jobs.calixtachat.com/webhooks/jbots/blob",e,!0),zs=e=>{const t={api_token:"r7okZQA95nI6JIcdOQtYl7bJKmhnEuVOxjtrUGpZiL9wj0FDNsVzGA18EvuT",resolved:"true",score:e},s=`${Ns()}/api/v1/chats/${msgParams.chat_id}/survey/score`;b(s,JSON.stringify(t),!1)},Gs=()=>{const e=Ht().find((e=>e.includes("yccht")));if(e)return Ie(e).subroute},Ws={Azure:"Azure"},Zs=(e,t=Ws.Azure,s={})=>ScriptFunctions.getOCRText(e,t,JSON.stringify(s)),Xs=(e,t)=>{const s={};return s.modelHubId=e,s.text=t,_("https://nlp.dev.hooks.yggs.io/api/Textalytics/classify",JSON.stringify(s))},Ys=(e,t,s,a,n)=>{const o={};o.id=e,o.text=t,o.intent=s,o.score=a,o.metrics=n;const r={};return r.botResponse=JSON.stringify(o),y("https://nlp.dev.hooks.yggs.io/api/BotResponse/upload",JSON.stringify(r),!1)},Hs=e=>void 0!==ys(e),Qs=e=>/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i.test(e),Ks=e=>e.search(/^\$?[\d,]+(\.\d*)?$/)>=0,ea=e=>!Number.isNaN(parseFloat(e))&&Number.isFinite(Number(e)),ta=e=>{const t=e.split("/"),s=new Date(t[2],t[1]-1,t[0]);return s&&s.getMonth()+1===Number(t[1])},sa=e=>/^[ a-zA-ZñÑáéíóúÁÉÍÓÚ]+$/.test(e),aa=(e,t)=>{if(!/(lunes|monday|martes|tuesday|miercoles|wednesday|jueves|thursday|viernes|friday|sabado|saturday|domingo|sunday)$/.test(e))return!1;const s=(new Date).toLocaleString("en-US",{timeZone:t});return["domingo","lunes","martes","miercoles","jueves","viernes","sábado"][new Date(s).getDay()]===e},na=e=>/^\d{4,5}$/.test(e),oa=e=>-1===Math.sign(e),ra=e=>/^(?=.{1,100}$)[a-zñáéíóúA-ZÑÁÉÍÓÚ](\s?[a-zñáéíóúA-ZÑÁÉÍÓÚ])*$/.test(e),ia=(e,t,s)=>{const a=(new Date).toLocaleString("en-US",{timeZone:s}),n=new Date(a),o=`${`0${n.getHours()}`.slice(-2)}:${`0${n.getMinutes()}`.slice(-2)}`;return e>t&&(o>=e||o<=t)||e<=o&&o<=t},ca=(e,t="America/Mexico_City")=>{const s=[],a=[],n=[];return Object.entries(e).forEach((([e,o])=>{if(Array.isArray(o))o.forEach((n=>{const o=n.split("|")[0].toLowerCase(),r=n.split("|")[1].split("~")[0],i=n.split("|")[1].split("~")[1];((e,t)=>!!/^(0[1-9]|1[0-2])(\/|-|.)([1-2]\d|0[1-9]|3[0-1])(\/|-|.)(\d{4})$/.test(e)&&(new Date).toLocaleString("en-US",{timeZone:t}).split(",")[0].replaceAll("/","-")===e)(o,t)&&ia(r,i,t)&&s.push(e),aa(o,t)&&ia(r,i,t)&&a.push(e)}));else{const s=o.split("~")[0],a=o.split("~")[1];ia(s,a,t)&&n.push(e)}})),r=a,i=n,(o=s).length>0?o[o.length-1]:r.length>0?r[r.length-1]:i.length>0?i[i.length-1]:void 0;var o,r,i};var da=a.Xb,la=a.tn,ua=a.zp,ga=a.W_,ma=a.cQ,pa=a.Wo;const va={production:{DEBUG:!1},rc:{DEBUG:!0},staging:{DEBUG:!0}},ha=ma.getText,fa=e=>{switch(e.id%3){case 1:pa.sendMessageText(ha("InfoPersonaje.buenaEleccion.uno"),0);break;case 2:pa.sendMessageText(ha("InfoPersonaje.buenaEleccion.dos"),0);break;default:pa.sendMessageText(ha("InfoPersonaje.buenaEleccion.tres"),0)}pa.sendCard(`${e.name}`,`{!strong!}${ha("InfoPersonaje.id")}:{!/strong!} ${e.id}\n{!strong!}${ha("InfoPersonaje.estado")}:{!/strong!} ${e.status}\n{!strong!}${ha("InfoPersonaje.especie")}:{!/strong!} ${e.species}\n{!strong!}${ha("InfoPersonaje.genero")}:{!/strong!} ${e.gender}\n{!strong!}${ha("InfoPersonaje.ubicacion")}:{!/strong!} ${e.location_name}`,e.image,"image/jpg",void 0,"vertical",void 0,void 0,1)},_a=e=>{try{const t=la.requestGet(`https://rickandmortyapi.com/api/character/${e}`);if(t.status_code>=100&&t.status_code<200?pa.sendMessageText("AVISO: El servidor ha recibido los encabezados de la solicitud y el cliente puede continuar enviando el cuerpo de la solicitud.",1):t.status_code>=200&&t.status_code<300||(t.status_code>=300&&t.status_code<400?pa.sendMessageText("AVISO: El recurso solicitado se ha movido temporal o permanentemente a otra ubicación.",1):t.status_code>=400&&t.status_code<500?pa.sendMessageText("ERROR: La solicitud contenía sintaxis inválida o faltaba información requerida.",1):t.status_code>=500&&t.status_code<600?pa.sendMessageText("ERROR: El servidor encontró un error al procesar la solicitud.",1):pa.sendMessageText("ERROR: Se devolvió un status code desconocido en la respuesta.",1)),t.status_code<200||t.status_code>=300)return pa.sendMessageText(`Status code: ${t.status_code}. El bot finalizará.`,2),void ga.setIdleFunction("cierreConversacion",3);const{content:{name:s,status:a,species:n,gender:o,location:{name:r},image:i}}=t;return{id:e,name:s,status:a,species:n,gender:o,location_name:r,image:i}}catch(e){pa.sendMessageText(`ERROR API: ${e}. El bot finalizará.`,2),ga.setIdleFunction("cierreConversacion",3)}},ya=ma.getText,ba=(e=0,t=!0)=>{const s=[];for(let e=0;e<5;e++){const e=(a=1,n=826,a=Math.ceil(a),n=Math.floor(n),Math.floor(Math.random()*(n-a+1)+a)),t=_a(e);t&&s.push(t)}var a,n;ua.setUserVar("INFO_PERSONAJES",s),pa.showMenu("menuVerPersonajesRandom",ya(t?"VerPersonajesRandom.mensaje":"VerPersonajesRandom.mensajeAlterno"),s.map((e=>e.name.length>20?e.name.substring(0,17)+"...":e.name)),void 0,void 0,void 0,e),ga.setNextFunction("VerPersonajesRandom.validaMenu")},Sa={menu:ba,validaMenu:()=>{const e=ua.getUserVar("INFO_PERSONAJES"),t=pa.evaluateMenuOption("menuVerPersonajesRandom",pa.getMessageText(),!1);t>=1&&t<=5?(fa(e[t-1]),ba(5,!1)):pa.sendMessageText(ya("VerPersonajesRandom.opcionInvalida"),0)}},$a=ma.getText,Pa=(e=0,t=!0)=>{pa.sendMessageText($a(t?"BuscarPersonaje.mensaje":"BuscarPersonaje.mensajeAlterno"),e),ga.setNextFunction("BuscarPersonaje.obtenerRespuesta")},Ma={menu:Pa,obtenerRespuesta:()=>{const e=pa.getMessageText(),t=_a(e);t&&(fa(t),Pa(5,!1))}},Ia=ma.getText,Aa={menu:()=>{pa.showMenu("menuPrincipal",Ia("MenuPrincipal.mensaje"),[Ia("MenuPrincipal.opcion.uno"),Ia("MenuPrincipal.opcion.dos")],void 0,void 0,void 0,2),ga.setNextFunction("MenuPrincipal.validaMenu")},validaMenu:()=>{switch(pa.evaluateMenuOption("menuPrincipal",pa.getMessageText(),!1)){case 1:Sa.menu();break;case 2:Ma.menu();break;default:pa.sendMessageText(Ia("MenuPrincipal.opcionInvalida"),0)}},finMenu:()=>{pa.sendMessageText(Ia("MenuPrincipal.despedida"),0),ga.setTerminated("finish",3)}},Na=(ma.getText,()=>{const e={menu:Aa.menu,adios:Aa.finMenu},t=pa.getMessageClean();return!(t in e)||((0,e[t])(),!1)}),xa=ma.getText,Oa=()=>{da.init(va),pa.sendMessageText(xa("Inicio.saludo"),0),pa.sendMessageText(xa("Inicio.aviso"),1),Aa.menu()},Ta=()=>{ga.setTerminated("finish",0)},Ca=()=>Na(),Va=()=>{},Ra=()=>{},Ea=()=>{ua.setCommandResponse(void 0,void 0,{})};exports.BotJS=t})();