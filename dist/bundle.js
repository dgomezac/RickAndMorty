(()=>{var e={d:(t,s)=>{for(var n in s)e.o(s,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:s[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};(()=>{"use strict";e.r(t),e.d(t,{BuscarPersonaje:()=>Nn,Memory:()=>gn,MenuPrincipal:()=>xn,Navigation:()=>mn,VerPersonajesRandom:()=>Mn,cierreConversacion:()=>Rn,commandReceived:()=>Fn,eventReceived:()=>wn,finish:()=>En,messageReceived:()=>jn,start:()=>Cn});var s={d:(e,t)=>{for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},n={};s.d(n,{AI:()=>m,kd:()=>p,Xb:()=>r,tn:()=>a,wB:()=>h,Yd:()=>o,zp:()=>u,st:()=>v,W_:()=>i,so:()=>d,mI:()=>c,cQ:()=>g,n8:()=>f,Wo:()=>l});var a={};s.r(a),s.d(a,{requestGet:()=>y,requestPost:()=>_,requestPut:()=>b});var r={};s.r(r),s.d(r,{get:()=>$,init:()=>P});var o={};s.r(o),s.d(o,{critical:()=>x,debug:()=>I,error:()=>V,info:()=>A,log:()=>M,logBot:()=>O,warning:()=>N});var i={};s.r(i),s.d(i,{execute:()=>B,getAttempts:()=>Y,getNextBotCalled:()=>W,getProcessedAttempts:()=>te,getTerminated:()=>J,getValidResult:()=>Z,idle:()=>D,processAttempt:()=>ee,resetAttempts:()=>H,setBotJS:()=>w,setIdleFunction:()=>G,setNextBot:()=>z,setNextFunction:()=>L,setTerminated:()=>U,setValidResult:()=>k,setWaitFunction:()=>q,validateAttempts:()=>X});var c={};s.r(c),s.d(c,{capitalizeFirstWord:()=>re,capitalizeText:()=>oe,cleanCapitalize:()=>ie,formattedJsonAsMessage:()=>ce,getNumber:()=>ae,levenstein:()=>ne,trimHelper:()=>se});var d={};s.r(d),s.d(d,{setDefaultValues:()=>le,setStepConversation:()=>de});var l={};s.r(l),s.d(l,{aiMessageType:()=>ue,cancelMessage:()=>He,createAction:()=>Re,createBodyMessageCard:()=>Oe,createBodyMessageCarousel:()=>Te,createBodyMessageCart:()=>Ce,createBodyMessageFile:()=>Ve,createBodyMessageTemplate:()=>xe,createBodyMessageText:()=>Ne,createInvite:()=>Me,createMessageAI:()=>Ae,createPaymentLink:()=>je,createUri:()=>Ie,createYggsMenu:()=>Be,evaluateMenuOption:()=>Le,getCoordinates:()=>Ke,getImageLink:()=>he,getImageTitle:()=>ve,getMessageClean:()=>Se,getMessageFormat:()=>Xe,getMessageText:()=>pe,messageAI:()=>Qe,sendAIMessage:()=>we,sendAction:()=>ye,sendAddToConversation:()=>$e,sendCard:()=>Ee,sendCarousel:()=>Fe,sendConsecutiveMessages:()=>me,sendDocument:()=>Ye,sendMenu:()=>Je,sendMessage:()=>be,sendMessageAudio:()=>ze,sendMessageDocument:()=>We,sendMessageForm:()=>Ze,sendMessageImage:()=>qe,sendMessageText:()=>Pe,sendMessageVideo:()=>Ge,setConsecutiveBehavior:()=>ge,showMenu:()=>De,validateMenu:()=>fe});var u={};s.r(u),s.d(u,{addJsonElement:()=>Kt,buildStepConversation:()=>ut,chatVarExists:()=>jt,clearDocumentVars:()=>$t,clearMemory:()=>Wt,clearScoreVars:()=>At,clearUserVars:()=>bt,getAiPayload:()=>wt,getBotUUID:()=>es,getBotVars:()=>ft,getChatVar:()=>Rt,getClientId:()=>Ft,getCommandResponse:()=>vt,getConsecutiveBehavior:()=>ct,getConversationId:()=>Et,getDocumentVar:()=>Pt,getGbmRobot:()=>ss,getInstantBehavior:()=>lt,getLocalRoute:()=>kt,getLocalSubroute:()=>Lt,getMessageId:()=>qt,getParticipantName:()=>Ht,getParticipants:()=>Zt,getParticipantsAgents:()=>Yt,getParticipantsBots:()=>Qt,getParticipantsUsers:()=>Xt,getProtocol:()=>Jt,getRemote:()=>Ut,getResult:()=>Gt,getScoreVar:()=>It,getSetting:()=>xt,getSettingBot:()=>Tt,getStepConversations:()=>zt,getUserId:()=>Bt,getUserVar:()=>_t,pushActionsMessages:()=>ht,pushCancelMessages:()=>pt,pushOutMessages:()=>gt,pushStepConversation:()=>mt,setChatVar:()=>Ct,setCommandResponse:()=>Nt,setConsecutiveBehavior:()=>it,setDocumentVar:()=>St,setGbmRobot:()=>ts,setInstantBehavior:()=>dt,setScoreVar:()=>Mt,setSetting:()=>Vt,setSettingBot:()=>Ot,setUserVar:()=>yt});var g={};s.r(g),s.d(g,{cleanPhone:()=>_s,createRegExp:()=>fs,evaluatePattern:()=>ys,fileToBase64:()=>is,geoDistance:()=>ds,getFormattedDate:()=>vs,getMultimedia:()=>ps,getRandomNumbers:()=>rs,getResource:()=>ms,getSecrets:()=>gs,getText:()=>us,guid:()=>os,lang:()=>ns,replaceGlobalVariables:()=>ls,secondsToTimestamp:()=>cs,welcomeMessage:()=>as});var m={};s.r(m),s.d(m,{agent:()=>bs,finishAI:()=>Is,getFullInteractionAI:()=>$s,getInteractionAI:()=>Ps,jsonFileName:()=>Ss,startAI:()=>Ms});var p={};s.r(p),s.d(p,{agentsGet:()=>Ls,channelsGet:()=>ks,chatAssignAgentById:()=>xs,chatAssignAgentByUsername:()=>Os,chatAssignChannelById:()=>Ts,chatAssignVirtualChannelById:()=>Cs,chatsAssign:()=>Vs,chatsClose:()=>Bs,chatsGet:()=>Rs,chatsGetContact:()=>js,chatsResult:()=>Ds,chatsSetMetadata:()=>Js,chatsSetTags:()=>Us,chatsStart:()=>Es,chatsUpdateContact:()=>ws,chatsWrite:()=>Fs,getChannel:()=>zs,getDomain:()=>Ns,getTenant:()=>As,jbotsBlob:()=>qs,sendScore:()=>Gs});var h={};s.r(h),s.d(h,{SERVICES_NAME:()=>Ws,getOCRText:()=>Zs});var v={};s.r(v),s.d(v,{evaluate:()=>Hs,sendFeedback:()=>Xs});var f={};s.r(f),s.d(f,{getScheduleType:()=>dn,isDate:()=>tn,isEmail:()=>Qs,isMoney:()=>Ks,isNegativeNumber:()=>rn,isNumeric:()=>en,isPhone:()=>Ys,isValidCP:()=>an,isValidCurrentDay:()=>nn,isValidName:()=>sn,isValidWord:()=>on});const y=(e,t="",s="{}",n=30)=>JSON.parse(ScriptFunctions.doGetRequest(e,t,s,n)),_=(e,t,s,n="{}",a=30)=>JSON.parse(ScriptFunctions.doPostRequest(e,t,s,n,a)),b=(e,t,s,n="{}",a=30)=>JSON.parse(ScriptFunctions.doPutRequest(e,t,s,n,a)),S=e=>`__env__${e}`,P=e=>{const t=e.staging;Object.keys(t).forEach((e=>{yt(S(e),t[e])}))},$=e=>_t(S(e)),M=(e,t="info")=>{const s=globalVars?.conversationId;let n=e;void 0!==s&&(n=`ConvId[${s}] ${e}`),ScriptFunctions.log(n,t)},I=e=>M(e,"debug"),A=e=>M(e,"info"),N=e=>M(e,"warning"),V=e=>M(e,"error"),x=e=>M(e,"critical"),O=(e,t=1)=>{$("DEBUG")&&Pe(`${us("MensajesGenerales.log")} ${e}`,t)};let T,C=!1,R=!1,j=!1;const w=e=>{T=e},E=()=>"undefined"!=typeof BotJS?BotJS:T,F=e=>{const{uri:t}=e;if(t.startsWith("yccht")){const e=Ie(t);yt("_tenant_name_",e.route),msgParams.tenant_name=e.route}},B=()=>{let e;if(void 0===botVars.user_vars&&(botVars.user_vars={}),void 0===botVars.doc_vars&&(botVars.doc_vars={}),msgParams.tenant_name=_t("_tenant_name_"),msgParams.chat_id=globalVars.conversationId,void 0===_t("_tenant_name_")){M("Tenant name es null");const e=Ie(msgParams.aiPayload.remote),{subroute:t}=e;if(yt("_tenant_name_",t),msgParams.tenant_name=t,M(`Tenant name es: ${t}`),void 0===msgParams.tenant_name&&"event"===msgParams.type&&"conversation"===msgParams.aiPayload.category&&"cdp"===msgParams.aiPayload.type){const{participants:e}=msgParams.aiPayload.body.cdp;e.forEach(F)}}if("message"===msgParams.type){const t={res:e};(e=>{if(e.res=E().messageReceived(),!1!==e.res&&!1===C)if(void 0!==botVars.function){let e=E();botVars.function.split(".").forEach((t=>{e=e[t]})),e()}else E().start()})(t),e=t.res}else"command"===msgParams.type&&"function"==typeof E().commandReceived?e=E().commandReceived():"event"===msgParams.type&&"function"==typeof E().eventReceived&&(e=E().eventReceived());C&&E().finish()},D=()=>{if(void 0!==botVars.idleFunction){let e=E();botVars.idleFunction.split(".").forEach((t=>{e=e[t]})),e()}},J=()=>C,U=(e,t)=>{C=!0;const s="finish"===e?"terminateConversation":"bye",n={};void 0!==t&&(n.delay=t),ye(s,n)},k=e=>{j=e},L=e=>{botVars.function!==e&&k(!0),botVars.function=e},q=L,G=(e,t)=>{botVars.idleFunction=e,ScriptFunctions.IdleTime(msgParams.unique_id,t,JSON.stringify(msgParams.aiPayload))},z=e=>{botVars.bot_name=e,botVars.function=void 0,R=!0},W=()=>R,Z=()=>j,H=(e="attempts")=>{yt(e+"_attempts_",0),yt("_attempts_",0)},X=(e="attempts",t=(()=>{}),s=(()=>{}),n=3)=>{let a=_t(e+"_attempts_");a?a+=1:a=1,yt(e+"_attempts_",a),a<n?"function"==typeof t&&t():"function"==typeof s&&s()},Y=(e="attempts")=>_t(e+"_attempts_")||0,Q=e=>"function"==typeof e,K=(e,t,s)=>{Q(e)&&t&&e(t,s)},ee=(e,t,s,n,a="",r=us("DEFAULT.RETRY"),o=3)=>{if(yt("_attempts_",(_t("_attempts_")||0)+1),_t("_attempts_")>=o)return K(t,e,us("DEFAULT.REPORT_CBOTS_DB_MAX_ATTEMPTS")),void(Q(n)&&n());a?q(a):Q(s)&&s(),Pe(r,1,{StepId:1e3}),K(t,e,us("DEFAULT.REPORT_CBOTS_DB_INVALID_ATTEMPT"))},te=()=>_t("_attempts_")||0,se=(e,t)=>{let s=0,n=e.length;for(;s<n&&e[s]===t;)s+=1;for(;n>s&&e[n-1]===t;)n-=1;return s>0||n<e.length?e.substring(s,n):e},ne=(e,t)=>{if(0===e.length)return t.length;if(0===t.length)return e.length;const s=[];let n,a;for(n=0;n<=t.length;n+=1)s[n]=[n];for(a=0;a<=e.length;a+=1)s[0][a]=a;for(n=1;n<=t.length;n+=1)for(a=1;a<=e.length;a+=1)t.charAt(n-1)===e.charAt(a-1)?s[n][a]=s[n-1][a-1]:s[n][a]=Math.min(s[n-1][a-1]+1,Math.min(s[n][a-1]+1,s[n-1][a]+1));return s[t.length][e.length]},ae=e=>e.match(/\d+/),re=e=>e.trim().replace(/^\w/,(e=>e.toUpperCase())),oe=e=>e.trim().toLowerCase().replace(/\w\S*/g,(e=>e.replace(/^\w/,(e=>e.toUpperCase())))),ie=e=>oe(Se(e)),ce=e=>{let t="";return Object.entries(e).forEach((([e,s])=>{t=`${t} ${e}: ${s}\n`})),t},de=({StepId:e,Content:t,Anchor:s,Name:n})=>({ConversationId:Et().toString(),BotId:es().toString(),ClientId:Ft(),UserId:Bt(),BusinessId:kt().toString(),DestinationId:Ut(),Steps:[{StepId:e,Name:n,Content:t,Anchor:s,AnchorStep:{SelectedOption:_t("anchorSelectedOption")}}]}),le=(e={})=>{if(void 0!==(e={Name:"",Anchor:!1,...e}).StepId)return e},ue={TEXT:"text",FILE:"file",CARD:"card",CAROUSEL:"carousel",TEMPLATE:"template",PAYMENTRESULT:"paymentResult",CUSTOM:"custom",CART:"cart"},ge=e=>{it(e)},me=()=>{const e=_t("__consecutiveMessages__");Array.isArray(e)&&e.length>0&&(ge(!0),e.forEach(gt))},pe=()=>msgParams.message,he=()=>wt()?.body?.url,ve=()=>wt()?.body?.title,fe=(e,t,s,n)=>{void 0===s&&(s=pe().toLowerCase());const a=s.match(/\d+(?:[.,]\d+)?/g);if(1===s.length&&n){const n=s.charCodeAt(0)-96;if(n>=e&&n<=t)return n}else if(null!=a){const s=parseInt(a[0],10);if(s===Number(a[0])&&s>=e&&s<=t)return s}return-1},ye=(e,t)=>{const s={};s.type=e,void 0!==t&&(s.params=t),ht(s)},_e=()=>{const e=ss();return e?{name:e,type:"robot"}:null},be=(e,t,s,n,a,r,o,i)=>{const c=os(),d={},l={version:"1.0.0",conversationId:"",originator:"",messageId:"",timestamp:"",language:"es",metadata:"",body:{}};o&&(l.whisper=o);const u=_e();if(u&&(l.originatorDescription=u),void 0!==e)if(null!==e){if(""!==e){switch(t){case"text":l.type=t,l.body.text=e;break;case"custom":l.type=t,l.body.text=e,l.customBody={},l.customBody.customType=a,l.customBody.formData=n;break;default:l.type="file",l.body.url=e,l.body.text=n,l.body.mime=r}return d.aiMessage=l,d.delay=s,gt(d,i),mt(e,i),c}M("Mensaje vacío","error")}else M("Mensaje null","error");else M("Mensaje undefined","error")},Se=e=>{if(void 0!==e||void 0!==(e=pe()))try{const t="àáäâèéëêìíïîòóöôùúüûñçßÿœæŕśńṕẃǵǹḿǘẍźḧ·/_,:;",s="aaaaeeeeiiiioooouuuuncsyoarsnpwgnmuxzh------",n=new RegExp(t.split("").join("|"),"g");return e=e.toString().toLowerCase().replace(/\s+/g,"-").replace(n,(e=>s.charAt(t.indexOf(e)))).replace(/[^\w-]+/g,"").replace(/--+/g,"-").replace(/-/g," "),e=se(e," ")}catch(e){}},Pe=(e,t,s)=>(s=le(s),be(e,"text",t,void 0,void 0,void 0,void 0,s)),$e=(e,t)=>{const s={};if(!1===Array.isArray(e)){const t=[];void 0!==e&&t.push(e),s.invites=t}else s.invites=e;if(!1===Array.isArray(t)){const e=[];void 0!==t&&e.push(t),s.messages=e}else s.messages=t;ye("addToConversation",s)},Me=(e,t,s,n)=>{const a={};if(void 0===e)return null;if(a.remote=e,void 0!==t)a.conversationId=t;else{if(t=globalVars?.conversationId,void 0===t)return null;a.conversationId=t}return void 0!==s?a.clientId=s:(s=msgParams.aiPayload?.clientId,a.clientId=void 0===s?0:s),void 0!==n?a.userId=n:(n=msgParams.aiPayload?.userId,a.userId=void 0===n?0:n),a},Ie=e=>e.match("^(?<protocol>.*?)://(?<destinatary>.*?)(:(?<subdestinatary>.*?)){0,1}(@(?<route>.*?)){0,1}(;(?<provider>.*?)){0,1}(:(?<subroute>.*?)){0,1}(/(?<extra>.*?)/{0,1}){0,1}(#(?<unique>.*)){0,1}$").groups,Ae=(e,t,s)=>{const n={ai:"1.0.0"};return n.messageId=os(),n.conversationId=globalVars?.conversationId,n.timestamp=(new Date).toISOString(),n.originator=globalVars?.originator,n.type=e,n.body=t,n.actions=s,n},Ne=e=>void 0===e?null:{text:e},Ve=(e,t,s,n,a)=>void 0===e||void 0===t?null:{url:e,mime:t,text:s,thumbnailUrl:n,fileName:a,forceRefresh:!1},xe=(e,t,s,n)=>void 0===e?null:{template:e,url:t,mime:s,params:n},Oe=(e,t,s,n,a,r="vertical",o="large",i=null)=>({title:e,description:t,url:s,orientation:r,size:o,alignment:i,mime:n,actions:a}),Te=(e,t)=>void 0===e?null:{items:e,width:t},Ce=(e,t,s,n,a)=>void 0===e||null==e||void 0===a?null:{catalogId:e,title:t,description:s,footer:n,productItems:a},Re=(e,t,s,n=null)=>void 0===e||void 0===t?null:{type:e,text:t,postback:s,actionData:n},je=(e,t,s,n,a)=>{const r={},o=[];let i;r.conversationId=e.conversationId,r.clientId=e.clientId,r.userId=e.userId,r.merchantId=n,void 0!==e.body?.text?r.description=e.body.text:r.description="Pago de productos",e.body?.productItems.forEach((e=>{const t={};t.quantity=e.quantity,t.unitPrice=100*e.itemPrice,void 0!==e?.productId&&(t.name=e.productId),i="MXN",o.push(t)}));const c=Ie(e.originator).destinatary;return void 0!==a&&""!==a&&null!=a||(a="Auronix"),r.customer={name:a,email:t,phone:c},r.itemsOrder=o,r.currency=i,r.paymentMethods=["card","transfer"],r.monthlyOptions=[3,6,9,12],r.eventsTextMode=!1,_(s,JSON.stringify(r),!0)},we=(e,t=0,s)=>{const n=void 0!==e.body?.text?e.body?.text:e.body,a=_e();a&&(e.originatorDescription=a),gt({aiMessage:e,delay:t}),s=le(s),mt(n,s)},Ee=(e,t,s,n,a,r="vertical",o="large",i=null,c=0,d)=>{const l=Oe(e,t,s,n,a,r,o,i),u=Ae(ue.CARD,l);we(u,c,d)},Fe=(e,t,s=0,n)=>{const a=((e,t)=>{for(let s=0;s<e.length;s+=1)e[s].orientation="vertical",e[s].size=t;return e})(e,t),r=Te(a,t),o=Ae(ue.CAROUSEL,r);return we(o,s,n),e},Be=(e,t,s,n,a)=>{const r=s.length,o=[];let i;for(let e=0;e<r;e+=1){const t=Re("reply",s[e],`${e+1}`);o.push(t)}if(void 0!==n){const e=Oe(void 0,t,n,"image/jpeg",o);i=Ae(ue.CARD,e)}else{const e=Ne(t);i=Ae(ue.TEXT,e,o)}return yt(`_menu_options_${e}`,s),yt(`_menu_text_${e}`,t),yt(`_menu_retries_${e}`,100),yt(`_menu_count_${e}`,0),yt(`_menu_letters_${e}`,!1),i},De=(e,t,s,n,a,r,o=0,i)=>{void 0!==i&&(i.Name=e);const c=Be(e,t,s,n,"auto");return we(c,o,i)},Je=(e,t,s,n,a=0,r=null,o)=>{void 0!==o&&(o.Name=e);const i=Be(e,t,s,n,"auto");return r&&(i.body.footer=r),we(i,a,o)},Ue=(e,t)=>{let s=ne(e,t);return(t.includes(e)||e.includes(t))&&(s=s/(Math.min(t.length,e.length)+1)*2),s},ke=(e,t,s,n,a)=>n<Math.max(t.length,e.length)/2?a+1:s,Le=(e,t,s=!1,n=!1,a=!1)=>{let r=-1;try{if(t.startsWith("http://")||t.startsWith("https://"))return-1;!0===n&&Pe(`Name: ${e}, Option: ${t}`);const o=_t(`_menu_options_${e}`);if(null!=o){const i=o.length;if(Object.keys(o).forEach((e=>{o[e]=`${Se(o[e])}`})),r=((e,t,s,n)=>{const a=t.length;let r="",o=fe(1,a,s,_t(`_menu_letters_${n}`));if(s=` ${Se(s)} `,!0===e&&Pe(`ValidateMenu: ${o}`),-1===o){let n=-1;for(let i=0;i<a;i+=1){const a=` ${t[i]} `,c=Ue(a,s);!0===e&&(r+=`${a}: ${c}\n`),(-1===n||-1!==n&&c<n)&&(n=c,o=ke(a,s,o,c,i))}!0===e&&Pe(r)}return o})(n,o,t,e),a&&yt("anchorSelectedOption",r),-1===r){const t=_t(`_menu_retries_${e}`),n=_t(`_menu_count_${e}`);if(-1==t||n<t){if(yt(`_menu_count_${e}`,n+1),!0===s){const t=_t(`_menu_text_${e}`);Pe(`Opción incorrecta. Se esperaba un número del 1 al ${i}. ${t}`)}}else U("start")}}}catch(e){return!0===n&&Pe(`Error: ${e}`),-1}return r},qe=(e,t,s,n)=>{n=le(n),be(e,"image",t,s,void 0,void 0,void 0,n)},Ge=(e,t,s,n,a)=>{a=le(a),be(e,"video",t,s,"video",n,void 0,a)},ze=(e,t,s,n)=>{n=le(n),be(e,"audio",t,"","audio",s,void 0,n)},We=(e,t,s,n)=>{n=le(n),be(e,"document",t,"","document",s,void 0,n)},Ze=(e,t,s,n,a)=>{a=le(a),be(e,"custom",t,s,n,void 0,void 0,a)},He=e=>pt(e),Xe=()=>msgParams.format,Ye=(e,t)=>{const s={};s.chat_id=msgParams.chat_id,s.name=botVars.bot_name,s.title=void 0===t?msgParams.sender:t,s.type=void 0===e?botVars.bot_name:e,s.values=botVars.doc_vars;const n=`${CalixtaChat.getDomain()}/webhooks/jbots/document`;_(n,JSON.stringify(s),!0)},Qe=(e,t,s)=>(void 0===msgParams.unique_id&&(msgParams.unique_id=""),s?JSON.parse(ScriptFunctions.dialogFlowDetectIntent(e,t,msgParams.unique_id,s)):JSON.parse(ScriptFunctions.aiTextRequest(e,msgParams.unique_id,t))),Ke=()=>{let e=null,t=null;const s=pe(),n=Xe();if("gps"===n&&s)[e,t]=s.split(",");else if("text"===n){let n=s.split("/").pop();n.includes(",")&&s.includes("google.com")&&s.includes("/maps/")&&(n=n.replace("@",""),[e,t]=n.split(","))}return{latitude:e,longitude:t}},et=[],tt=[],st=[],nt=[];let at=!1,rt={},ot=!1;const it=e=>{at=e},ct=()=>at,dt=e=>{ot=e},lt=()=>ot,ut=(e,t)=>de({StepId:t.StepId,Content:e,Anchor:t.Anchor,Name:t.Name}),gt=(e,t=null)=>{if(lt()){let{delay:s}=e;s||(s=0),e.delay=s+1;const n=t?ut(e.aiMessage.body.text,t):null;ScriptFunctions.SendInstantMessage(msgParams.aiPayload.messageId,JSON.stringify(e),n?JSON.stringify(n):null)}else et.push(e)},mt=(e,t)=>{if(void 0===t)return;const s=ut(e,t);tt.push(s)},pt=e=>{st.push(e)},ht=e=>{if(lt()){const{params:t}=e;if(t){let{delay:s}=t;s||(s=1),e.params.delay=-s}ScriptFunctions.SendInstantAction(msgParams.aiPayload.messageId,JSON.stringify(e))}else nt.push(e)},vt=()=>rt,ft=()=>JSON.stringify(botVars),yt=(e,t)=>{botVars.user_vars[e]=t},_t=e=>botVars.user_vars[e],bt=()=>{botVars.user_vars={}},St=(e,t,s="text",n)=>{botVars.doc_vars[e]={format:s,value:t,...n&&{param:n}}},Pt=e=>botVars.doc_vars[e],$t=()=>{botVars.doc_vars={}},Mt=(e,t,s="text")=>{botVars.score_vars[e]={format:s,value:t}},It=e=>botVars.score_vars[e],At=()=>{botVars.score_vars={}},Nt=(e,t,s)=>{rt={...rt,type:e,uri:t,events:s}},Vt=(e,t)=>ScriptFunctions.setSetting(globalVars.scriptName,e,t),xt=e=>ScriptFunctions.getSetting(globalVars.scriptName,e),Ot=(e,t)=>ScriptFunctions.setSetting(`${globalVars.scriptName}:${msgParams.sender}`,e,t),Tt=e=>ScriptFunctions.getSetting(`${globalVars.scriptName}:${msgParams.sender}`,e),Ct=(e,t)=>{const s=`${msgParams.chat_id}_${msgParams.unique_id}`;ScriptFunctions.setVar(s,e,t)},Rt=e=>{const t=`${msgParams.chat_id}_${msgParams.unique_id}`;return ScriptFunctions.getVar(t,e)},jt=e=>{const t=`${msgParams.chat_id}_${msgParams.unique_id}`;return ScriptFunctions.varExists(t,e)},wt=()=>msgParams.aiPayload??{},Et=()=>wt().conversationId,Ft=()=>(M(`AIPayload: ${JSON.stringify(wt())}`),wt().clientId),Bt=()=>wt().userId,Dt=()=>wt().originator,Jt=()=>Ie(Dt()).protocol,Ut=()=>Ie(Dt()).destinatary,kt=()=>Ie(Dt()).route,Lt=()=>Ie(Dt()).subroute,qt=()=>msgParams.aiPayload.messageId,Gt=()=>{const e={messages:ct()?et.slice(0,1):et,cancel:st,actions:nt,response:rt};return ct()&&yt("__consecutiveMessages__",et.slice(1)),JSON.stringify(e)},zt=()=>JSON.stringify(tt),Wt=()=>{tt.splice(0,et.length),et.splice(0,et.length),st.splice(0,st.length),nt.splice(0,nt.length),at=!1,rt={},ot=!1},Zt=()=>_t("__participants__"),Ht=()=>{const e=Zt();if(Array.isArray(e)&&e.length)return e.filter((e=>{const t=e.remoteInfo?.isSystem,{protocol:s}=Ie(e.uri);return!("true"===t||["db","balancer","flowjs","yccht"].includes(s))}))[0].remoteInfo?.displayName},Xt=()=>{const e=Zt();if(Array.isArray(e)&&e.length){const t=["db","balancer","flowjs","yccht"];return e.filter((e=>{const{protocol:s}=Ie(e.uri);return!t.includes(s)})).map((e=>e.uri))}},Yt=()=>{const e=Zt();if(Array.isArray(e)&&e.length)return e.filter((e=>{const{protocol:t}=Ie(e.uri);return"yccht"===t})).map((e=>e.uri))},Qt=()=>{const e=Zt();if(Array.isArray(e)&&e.length)return e.filter((e=>{const{protocol:t}=Ie(e.uri);return"flowjs"===t})).map((e=>e.uri))},Kt=(e,t,s)=>{let n=_t(s);n||(n={},yt(s,n)),n[e]=t,yt(s,n)},es=()=>globalVars.scriptName,ts=e=>{yt("__gbm__robotName__",e)},ss=()=>_t("__gbm__robotName__"),ns="es",as=()=>{const e=(new Date).toLocaleString("es-MX",{timeZone:"America/Mexico_City"}),t=new Date(e).getHours();return t>=0&&t<12?"Buenos días":t>=12&&t<19?"Buenas tardes":"Buenas noches"},rs=()=>[Random.NextDouble()],os=()=>Guid.NewGuid(),is=e=>ScriptFunctions.fileToBase64(e),cs=(e=0)=>{const t=new Date;return t.setSeconds(t.getSeconds()+e),0===e?e:Math.floor(t/1e3)},ds=(e,t,s,n)=>{if(e===s&&t===n)return 0;const a=Math.PI*e/180,r=Math.PI*s/180,o=t-n,i=Math.PI*o/180;let c=Math.sin(a)*Math.sin(r)+Math.cos(a)*Math.cos(r)*Math.cos(i);return c>1&&(c=1),c=Math.acos(c),c=180*c/Math.PI,c=60*c*1.853159616,c},ls=e=>{const t=/(\{\$)([A-Z\d_])+(\$\})/g;if(null!=e){const s=e.match(t);if(null!=s)return s.filter(((e,t,s)=>s.indexOf(e)===t)).forEach((t=>{const s=t.replace("{$","").replace("$}","");e=e.replaceAll(t,_t(s))})),ls(e)}return e},us=e=>{let t=resourcesConsts;const s=e.split(".");return s.unshift(ns),s.some((e=>(t=t[e]?t[e]:void 0,"object"!=typeof t))),"string"==typeof t?ls(t):e},gs=e=>void 0!==secretsConsts[e]?secretsConsts[e]:e,ms=e=>{let t=resourcesConsts;const s=e.split(".");if(s.unshift(ns),s.some((e=>(t=e in t?t[e]:void 0,"object"!=typeof t))),void 0!==t){const e=JSON.stringify(t),s=ls(e);return JSON.parse(s)}return e},ps=(e,t=null)=>{const s=multimediaConsts.filter((t=>t.name===e))[0];return s?t?s[t]:s:null},hs=e=>e.toString().padStart(2,"0"),vs=(e="dd/mm/aaaa",t=new Date)=>{if(t instanceof Date!=1)return"Not valid date instance";if("string"!=typeof e)return"Not valid format";const s=t.getFullYear(),n=s.toString().substring(2),a=hs(t.getMonth()+1),r=hs(t.getDate()),o=hs(t.getHours()),i=hs(t.getMinutes()),c=hs(t.getSeconds());let d="";switch(e){case"dd-mm-aaaa":d=`${r}-${a}-${s}`;break;case"aaaa/mm/dd":d=`${s}/${a}/${r}`;break;case"mm/dd/aa":d=`${a}/${r}/${n}`;break;case"dd/mm/aa hh:mm:ss":d=`${r}/${a}/${n} ${o}:${i}:${c}`;break;case"dd/mm/aaaa hh:mm:ss":d=`${r}/${a}/${s} ${o}:${i}:${c}`;break;default:d=`${r}/${a}/${s}`}return d},fs=e=>{const t=e.length,s=e.substring(0,1),n=e.substring(t-1,t),a=e.replace("*","");return s.includes("*")&&n.includes("*")?new RegExp(`${a}`,"i"):s.includes("*")?new RegExp(`${a}$`,"i"):n.includes("*")?new RegExp(`^${a}`,"i"):new RegExp(`^${a}$`,"i")},ys=(e,t)=>{let s=!1;const n=Se(e.toLowerCase());return t.forEach((e=>{const t=e.toLowerCase();fs(t).test(n)&&(s=!0)})),s},_s=e=>{try{const t=/\d+/g,s=e.match(t).join("");return s.length>=10&&s.length<=14?s:void 0}catch(e){return}},bs="interactions-a9e51",Ss=`${bs}-d19584f55070.json`,Ps=e=>{try{const t=JSON.parse(ScriptFunctions.dialogFlowDetectIntent(Ss,bs,`${msgParams.unique_id}_${Math.floor(1e4*rs()[0]+1)}`,e));return"Default Fallback Intent"===t.intent?"none":t.intent}catch(e){return"none"}},$s=e=>JSON.parse(ScriptFunctions.dialogFlowDetectIntent(Ss,bs,`${msgParams.unique_id}_${Math.floor(1e4*rs()[0]+1)}`,e)),Ms=e=>ScriptFunctions.aiStartAgent(msgParams.unique_id,e),Is=()=>ScriptFunctions.aiFinishAgent(msgParams.unique_id),As=()=>msgParams.tenant_name,Ns=(e=null)=>{const t=As();let s=e||"calixtachat";return"sandbox"!==t||e||(s="dev.aurochat"),`https://${t}.${s}.com`},Vs=(e,t={},s=null)=>{const n=msgParams.chat_id,a=`${Ns(s)}/api/v1/chats/${n}/assign`,r={...t,api_token:e};return b(a,JSON.stringify(r),!1)},xs=(e,t,s=null)=>Vs(e,{user_id:t},s),Os=(e,t,s=null)=>Vs(e,{username:t},s),Ts=(e,t,s=null)=>Vs(e,{channel_id:t},s),Cs=Ts,Rs=e=>{const t=`${Ns()}/api/v1/chats/${msgParams.chat_id}`,s={api_token:e};return y(t,JSON.stringify(s))},js=e=>{const t=`${Ns()}/api/v1/chats/${msgParams.chat_id}/contact`,s={api_token:e};return y(t,JSON.stringify(s))},ws=(e,t={})=>{const s=`${Ns()}/api/v1/chats/${msgParams.chat_id}/contact`,n={...t,api_token:e};return b(s,JSON.stringify(n),!1)},Es=(e,t={})=>{const s=`${Ns()}/api/v1/chats`,n={...t,api_token:e};return _(s,JSON.stringify(n),!1)},Fs=(e,t={})=>{const s=`${Ns()}/api/v1/chats/${msgParams.chat_id}/write`,n={...t,api_token:e};return _(s,JSON.stringify(n),!1)},Bs=(e,t={},s=msgParams.chat_id)=>{const n=`${Ns()}/api/v1/chats/${s}/close`,a={...t,api_token:e};return b(n,JSON.stringify(a),!1)},Ds=(e,t={},s=msgParams.chat_id)=>{const n=`${Ns()}/api/v1/chats/${s}/result`,a={...t,api_token:e};return b(n,JSON.stringify(a),!1)},Js=(e,t,s)=>{const n=`${Ns()}/api/v1/chats/${msgParams.chat_id}/metadata`,a={api_token:e};return a[t]=s,b(n,JSON.stringify(a),!1)},Us=(e,t)=>{const s=`${Ns()}/api/v1/chats/${msgParams.chat_id}/tags`,n={tags:t,api_token:e};return b(s,JSON.stringify(n),!1)},ks=e=>{const t=`${Ns()}/api/v1/channels`,s={api_token:e};return y(t,JSON.stringify(s))},Ls=(e,t)=>{const s=`${Ns()}/api/v1/agents`;let n={};return void 0!==t&&(n=t),n.api_token=e,y(s,JSON.stringify(n))},qs=e=>_("https://demos.jobs.calixtachat.com/webhooks/jbots/blob",e,!0),Gs=e=>{const t={api_token:"r7okZQA95nI6JIcdOQtYl7bJKmhnEuVOxjtrUGpZiL9wj0FDNsVzGA18EvuT",resolved:"true",score:e},s=`${Ns()}/api/v1/chats/${msgParams.chat_id}/survey/score`;b(s,JSON.stringify(t),!1)},zs=()=>{const e=Yt().find((e=>e.includes("yccht")));if(e)return Ie(e).subroute},Ws={Azure:"Azure"},Zs=(e,t=Ws.Azure,s={})=>ScriptFunctions.getOCRText(e,t,JSON.stringify(s)),Hs=(e,t)=>{const s={};return s.modelHubId=e,s.text=t,y("https://nlp.dev.hooks.yggs.io/api/Textalytics/classify",JSON.stringify(s))},Xs=(e,t,s,n,a)=>{const r={};r.id=e,r.text=t,r.intent=s,r.score=n,r.metrics=a;const o={};return o.botResponse=JSON.stringify(r),_("https://nlp.dev.hooks.yggs.io/api/BotResponse/upload",JSON.stringify(o),!1)},Ys=e=>void 0!==_s(e),Qs=e=>/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i.test(e),Ks=e=>e.search(/^\$?[\d,]+(\.\d*)?$/)>=0,en=e=>!Number.isNaN(parseFloat(e))&&Number.isFinite(Number(e)),tn=e=>{const t=e.split("/"),s=new Date(t[2],t[1]-1,t[0]);return s&&s.getMonth()+1===Number(t[1])},sn=e=>/^[ a-zA-ZñÑáéíóúÁÉÍÓÚ]+$/.test(e),nn=(e,t)=>{if(!/(lunes|monday|martes|tuesday|miercoles|wednesday|jueves|thursday|viernes|friday|sabado|saturday|domingo|sunday)$/.test(e))return!1;const s=(new Date).toLocaleString("en-US",{timeZone:t});return["domingo","lunes","martes","miercoles","jueves","viernes","sábado"][new Date(s).getDay()]===e},an=e=>/^\d{4,5}$/.test(e),rn=e=>-1===Math.sign(e),on=e=>/^(?=.{1,100}$)[a-zñáéíóúA-ZÑÁÉÍÓÚ](\s?[a-zñáéíóúA-ZÑÁÉÍÓÚ])*$/.test(e),cn=(e,t,s)=>{const n=(new Date).toLocaleString("en-US",{timeZone:s}),a=new Date(n),r=`${`0${a.getHours()}`.slice(-2)}:${`0${a.getMinutes()}`.slice(-2)}`;return e>t&&(r>=e||r<=t)||e<=r&&r<=t},dn=(e,t="America/Mexico_City")=>{const s=[],n=[],a=[];return Object.entries(e).forEach((([e,r])=>{if(Array.isArray(r))r.forEach((a=>{const r=a.split("|")[0].toLowerCase(),o=a.split("|")[1].split("~")[0],i=a.split("|")[1].split("~")[1];((e,t)=>!!/^(0[1-9]|1[0-2])(\/|-|.)([1-2]\d|0[1-9]|3[0-1])(\/|-|.)(\d{4})$/.test(e)&&(new Date).toLocaleString("en-US",{timeZone:t}).split(",")[0].replaceAll("/","-")===e)(r,t)&&cn(o,i,t)&&s.push(e),nn(r,t)&&cn(o,i,t)&&n.push(e)}));else{const s=r.split("~")[0],n=r.split("~")[1];cn(s,n,t)&&a.push(e)}})),o=n,i=a,(r=s).length>0?r[r.length-1]:o.length>0?o[o.length-1]:i.length>0?i[i.length-1]:void 0;var r,o,i};var ln=n.Xb,un=n.tn,gn=n.zp,mn=n.W_,pn=n.cQ,hn=n.Wo;const vn={production:{DEBUG:!1},rc:{DEBUG:!0},staging:{DEBUG:!0}},fn=pn.getText,yn=e=>{switch(e.id%3){case 1:hn.sendMessageText(fn("InfoPersonaje.buenaEleccion.uno"),0);break;case 2:hn.sendMessageText(fn("InfoPersonaje.buenaEleccion.dos"),0);break;default:hn.sendMessageText(fn("InfoPersonaje.buenaEleccion.tres"),0)}hn.sendCard(`${e.name}`,`{!strong!}${fn("InfoPersonaje.id")}:{!/strong!} ${e.id}\n{!strong!}${"Alive"===e.status?fn("InfoPersonaje.estadoVivo"):fn("InfoPersonaje.estadoMuerto")}:{!/strong!} ${e.status}\n{!strong!}${"Human"===e.species?fn("InfoPersonaje.especieHumano"):fn("InfoPersonaje.especieAlien")}:{!/strong!} ${e.species}\n{!strong!}${fn("InfoPersonaje.ubicacion")}:{!/strong!} ${e.location_name}`,e.image,"image/jpg",void 0,"vertical",void 0,void 0,1)},_n=e=>{try{const t=un.requestGet(`https://rickandmortyapi.com/api/character/${e}`);if(200===t.status_code){const{content:{name:s,status:n,species:a,location:{name:r},image:o}}=t;return{id:e,name:s,status:n,species:a,location_name:r,image:o}}hn.sendMessageText(`Status code: ${t.status_code}. El bot finalizará.`,2),mn.setIdleFunction("cierreConversacion",3)}catch(e){hn.sendMessageText(`ERROR API: ${e}. El bot finalizará.`,2),mn.setIdleFunction("cierreConversacion",3)}},bn=pn.getText,Sn=e=>{gn.setUserVar("intentos",gn.getUserVar("intentos")+1),gn.getUserVar("intentos")<3?hn.sendMessageText(e,1):(hn.sendMessageText(bn("MensajesGenerales.intentosAgotados")),mn.setIdleFunction("finish",3))},Pn=pn.getText,$n=(e=0,t=!0)=>{const s=[];for(let e=0;e<5;e++){const e=(n=1,a=826,n=Math.ceil(n),a=Math.floor(a),Math.floor(Math.random()*(a-n+1)+n)),t=_n(e);t&&s.push(t)}var n,a;gn.setUserVar("INFO_PERSONAJES",s),hn.showMenu("menuVerPersonajesRandom",Pn(t?"VerPersonajesRandom.mensaje":"VerPersonajesRandom.mensajeAlterno"),s.map((e=>e.name.length>20?e.name.substring(0,17)+"...":e.name)),void 0,void 0,void 0,e),mn.setNextFunction("VerPersonajesRandom.validaMenu")},Mn={menu:$n,validaMenu:()=>{const e=gn.getUserVar("INFO_PERSONAJES"),t=hn.evaluateMenuOption("menuVerPersonajesRandom",hn.getMessageText(),!1);t>=1&&t<=5?(gn.setUserVar("intentos",0),yn(e[t-1]),$n(5,!1)):Sn(Pn("VerPersonajesRandom.opcionInvalida"))}},In=pn.getText,An=(e=0,t=!0)=>{hn.sendMessageText(In(t?"BuscarPersonaje.mensaje":"BuscarPersonaje.mensajeAlterno"),e),mn.setNextFunction("BuscarPersonaje.obtenerRespuesta")},Nn={menu:An,obtenerRespuesta:()=>{const e=parseInt(hn.getMessageText(),10);if(Number.isInteger(e)&&e>=1&&e<=826){gn.setUserVar("intentos",0);const t=_n(e);t&&(yn(t),An(5,!1))}else Sn(In("BuscarPersonaje.opcionInvalida"))}},Vn=pn.getText,xn={menu:()=>{hn.showMenu("menuPrincipal",Vn("MenuPrincipal.mensaje"),[Vn("MenuPrincipal.opcion.uno"),Vn("MenuPrincipal.opcion.dos")],void 0,void 0,void 0,2),mn.setNextFunction("MenuPrincipal.validaMenu")},validaMenu:()=>{switch(hn.evaluateMenuOption("menuPrincipal",hn.getMessageText(),!1)){case 1:gn.setUserVar("intentos",0),Mn.menu();break;case 2:gn.setUserVar("intentos",0),Nn.menu();break;default:Sn(Vn("MenuPrincipal.opcionInvalida"))}},finMenu:()=>{hn.sendMessageText(Vn("MenuPrincipal.despedida"),0),mn.setTerminated("finish",3)}},On=(pn.getText,()=>{const e={menu:xn.menu,adios:xn.finMenu},t=hn.getMessageClean();return!(t in e)||((0,e[t])(),!1)}),Tn=pn.getText,Cn=()=>{ln.init(vn),gn.setUserVar("intentos",0),hn.sendMessageText(Tn("Inicio.saludo"),0),hn.sendMessageText(Tn("Inicio.aviso"),1),xn.menu()},Rn=()=>{mn.setTerminated("finish",0)},jn=()=>On(),wn=()=>{},En=()=>{},Fn=()=>{gn.setCommandResponse(void 0,void 0,{})}})(),BotJS=t})();